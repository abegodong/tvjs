/*! TVJS - v1.0 - 2013-06-26
 * https://github.com/abegodong/tvjs
 * Copyright (c) 2013 Abraham Godong; Licensed MIT */
!function(a){"use strict";var b,c,d={tv:function(){var e={33:"1",64:"2",35:"3",36:"4",37:"5",94:"6",38:"7",42:"8",40:"9",41:"0"};c.root.data("channel",""),c.root.data("switchTo",""),c.root.data("pipChannel",""),c.root.data("pipSwitchTo",""),c.root.data("pipLocation",0),b.channels=[{}].concat(b.channels),c=a.extend({content:a("<div />").attr("id","tv_content").css({width:"100%",height:"100%"}).appendTo(c.root),help:a("<div />").attr("id","tv_help").addClass("tv_help tv_wrap").appendTo(c.root),guide:a("<div />").attr("id","tv_guide").addClass("tv_wrap").appendTo(c.root),pip:a("<div />").attr("id","tv_pip").addClass("tv_wrap").appendTo(c.root)},c),c.help.html(d.loadHelp()),a(window).on("hashchange",function(){d.handleHashChange()}),d.retrieveChannel(),a(document).keypress(function(f){var g=f.charCode;if(void 0!==g&&g>47&&58>g){clearTimeout(a.data(this,"timer"));var h=c.root.data("switchTo");(g>48||""!==c.root.data("switchTo"))&&(h=h.concat(g-48),c.root.data("switchTo",h)),a(this).data("timer",setTimeout(function(){c.root.data("switchTo",c.root.data("switchTo")>>>0),window.location.hash=c.root.data("switchTo")},600))}else if(void 0!==g&&void 0!==e[g]&&b.allowPiP===!0){clearTimeout(a.data(this,"pipTimer"));var i=c.root.data("pipSwitchTo");(e[g]>0||""!==i)&&(i=i.toString().concat(e[g]),c.root.data("pipSwitchTo",i)),a(this).data("pipTimer",setTimeout(function(){c.root.data("pipSwitchTo",c.root.data("pipSwitchTo")>>>0),d.loadPiP()},600))}else b.allowPiP!==!0||80!==g&&112!==g?72===g||104===g?c.help.toggle():82===g||114===g?(c.root.data("switchTo",c.root.data("channel")),d.loadChannel(!0)):67===g||99===g?d.loadGuide(c.root.data("channel")):b.allowPiP!==!0||83!==g&&115!==g||(c.root.data("switchTo",c.root.data("pipChannel")),c.root.data("pipSwitchTo",c.root.data("channel")),window.location.hash=c.root.data("switchTo"),d.loadPiP()):d.movePiP()}),a(document).keyup(function(a){var e=c.root.data("channel")>>>0;27===a.keyCode||81===a.keyCode?c.help.is(":visible")?c.help.toggle():c.pip.is(":visible")?(c.pip.toggle(),c.root.data("pipSwitchTo",c.root.data("pipChannel")),c.root.data("pipLocation",(c.root.data("pipLocation")-1)%5)):window.location.hash="":(37===a.keyCode||40===a.keyCode)&&e-1>=1?d.channelDown():(39===a.keyCode||38===a.keyCode)&&b.channels.length>e+1&&d.channelUp()}),a(window).resize(function(){c.root.data("switchTo",c.root.data("channel")),d.loadChannel(!1)})},loadIntro:function(){/webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)?c.content.html('<div class="tv_message">Change URL Hash to Channel Number to start streaming</div>'):c.content.html('<div class="tv_message">Press "H" for help and see channels listing or press a number key to start streaming</div>'),document.title=b.name,d.storeChannel(""),c.root.data("switchTo","")},loadError:function(a){var b={1:'Invalid Channel! Please enter valid channel number<br />or press "H" for help and see channels listing.',2:"Sorry this channel is not currently available for mobile device!",3:"General Error! Please try reloading site."};c.content.html('<div class="tv_message tv_error">'+b[a]+"</div>"),d.loadTitle("Error! Error code: "+a),c.root.data("switchTo","")},loadTitle:function(a){b.useTitle===!0&&(document.title=a)},loadHelp:function(){var c="<p>To start streaming: press your number key corresponding to the channel number below.</p>";return c+="<DL>",a.each(b.channels,function(a,b){0!==a&&(c+="<DT>"+a+"</DT>",c+="<DD>"+b.name+"</DD>")}),c+="</DL>",c+='<p>Press "H" or "ESC" to close this help menu.<br />Press "R" to reload channel</p>'},loadGuide:function(a,d){if(""!==a)if(d="undefined"!=typeof d?d:!1,d===!1)c.guide.css({top:"0",left:"0"}),c.guide.html(b.channels[a].name).fadeIn(2e3).fadeOut(4e3);else{var e=c.pip.position();c.guide.css({top:e.top,left:e.left}),c.guide.html(b.channels[a].name).fadeIn(2e3).fadeOut(4e3)}},loadChannel:function(a){var e=c.root.data("switchTo");/webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)?b.mobileSupport===!0&&""!==b.channels[e].mobile?(a===!0&&d.loadGuide(e),c.content.html('<video width="100%" height="100%" src="'+b.channels[e].mobile+'" />'),d.loadTitle(b.channels[e].name)):(d.loadError(2),e=""):(a===!0&&d.loadGuide(e),c.content.html('<embed wmode="transparent" width="100%" height="100%" allowfullscreen="true" allowscriptaccess="always" bgcolor="#000000" flashvars="src='+b.channels[e].url+'&amp;autoHideControlBar=true&amp;streamType=live&amp;autoPlay=true&amp;scaleMode=stretch" pluginspage="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash" quality="medium" src="http://fpdownload.adobe.com/strobe/FlashMediaPlayback_101.swf?rnd=4/[[DYNAMIC]]/1" type="application/x-shockwave-flash">'),d.loadTitle(b.channels[e].name)),c.root.data("channel",e),d.storeChannel(e),c.root.data("switchTo","")},loadPiP:function(){var a=c.root.data("pipSwitchTo");/webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)?c.pip.html('<div class="tv_error">Feature not available in mobile devices.</div>'):c.pip.is(":visible")&&""!==a?void 0===b.channels[a]||0===b.channels[a]?(c.pip.html("Invalid Channel! Please enter valid channel number."),c.root.data("pipChannel",""),c.root.data("pipSwitchTo","")):(c.pip.html('<embed wmode="transparent" width="300" height="225" allowfullscreen="false" allowscriptaccess="always" bgcolor="#000000" flashvars="src='+b.channels[a].url+'&amp;autoHideControlBar=true&amp;streamType=live&amp;autoPlay=true&amp;scaleMode=stretch&amp;muted=true" pluginspage="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash" quality="medium" src="http://fpdownload.adobe.com/strobe/FlashMediaPlayback_101.swf?rnd=4/[[DYNAMIC]]/1" type="application/x-shockwave-flash">'),c.root.data("pipChannel",a),c.root.data("pipSwitchTo",""),d.loadGuide(a,!0)):""===c.root.data("pipChannel")&&c.pip.html("Please select a PiP Channel.")},movePiP:function(){var a=(c.root.data("pipLocation")+1)%5;0===a&&c.pip.is(":visible")&&(c.root.data("pipSwitchTo",c.root.data("pipChannel")),c.pip.hide()),1===a?(c.pip.css({top:"0",left:"0",right:"auto",bottom:"auto",display:"block"}),d.loadPiP()):2===a?(c.pip.css({top:"0",left:"auto",right:"0",bottom:"auto",display:"block"}),d.loadPiP()):3===a?(c.pip.css({top:"auto",left:"auto",right:"0",bottom:"0",display:"block"}),d.loadPiP()):4===a&&(c.pip.css({top:"auto",left:"0",right:"auto",bottom:"0",display:"block"}),d.loadPiP()),c.root.data("pipLocation",a)},handleHashChange:function(){var a=window.location.hash.substring(1);("null"===a||0===a)&&(window.location.hash="",a=""),""===a?d.loadIntro():void 0===b.channels[a]?(c.root.data("channel",""),c.root.data("switchTo",""),d.loadError(1)):(c.root.data("channel",a),c.root.data("switchTo",a),d.loadChannel(!0))},channelUp:function(){var a=c.root.data("channel")>>>0;c.root.data("switchTo",a+1),window.location.hash=c.root.data("switchTo")},channelDown:function(){var a=c.root.data("channel")>>>0;c.root.data("switchTo",a-1),window.location.hash=c.root.data("switchTo")},storeChannel:function(a){b.useLocalStorage===!0&&"undefined"!=typeof Storage&&localStorage.setItem("tvChannel",a)},removeChannel:function(){b.useLocalStorage===!0&&"undefined"!=typeof Storage&&localStorage.removeItem("tvChannel")},retrieveChannel:function(){var a=window.location.hash.substring(1);b.useLocalStorage===!0&&"undefined"!=typeof Storage&&""===a&&"undefined"!==localStorage.tvChannel&&""!==localStorage.tvChannel?window.location.hash=localStorage.getItem("tvChannel"):d.handleHashChange()}};a.fn.tv=function(e){b=a.extend({name:"TV Streamer",mobileSupport:!0,useLocalStorage:!0,channels:[{}],defaultChannel:!1,autoPlay:!0,useTitle:!0,allowPiP:!0},e),a(this).addClass("tvContainer"),c=a.extend({root:a(this)},c),d.tv()}}(jQuery);